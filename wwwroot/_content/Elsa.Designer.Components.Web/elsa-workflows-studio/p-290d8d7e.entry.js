import{r as s,c as e,h as l,H as a}from"./p-9ac75b7d.js";import{c as t}from"./p-c912e9a0.js";import{h as i}from"./p-e4caa342.js";import{e as n,l as r}from"./p-fd4270fe.js";import{a as o}from"./p-60999205.js";import{a as c}from"./p-f0c26962.js";import{d,c as u}from"./p-ab6c762d.js";import"./p-bd8b186e.js";import"./p-80452beb.js";import"./p-adbb57a5.js";import"./p-52f280e6.js";const m=class{constructor(a){s(this,a),this.recordSelected=e(this,"recordSelected",7),this.activityDescriptors=[],this.isVisible=!0,this.records={items:[],totalCount:0},this.filteredRecords=[],this.selectedTabId="journal",this.tabs=[],this.renderJournalTab=()=>{const e=this.filteredRecords,s=this.activityDescriptors,a=this.workflowBlueprint.activities||[],r=this.selectedRecordId;return l("div",{class:"flow-root"},l("ul",{class:"-elsa-mb-8"},e.map(((n,c)=>{const m=c==e.length-1,p=m?null:e[c+1],f=i(n.timestamp),h=m?null:i(p.timestamp),x=m?null:i.duration(h.diff(f)),v=n.activityType,g=o.getIcon(v),b=s.find((e=>e.type===v)),w=a.find((e=>e.id===n.activityId))||{name:null,displayName:null},y=w.displayName||w.name||b.displayName||b.type,k=n.eventName,I=this.getEventColor(k),C=n.id===r?"elsa-border-blue-600":"hover:elsa-bg-gray-100 elsa-border-transparent",j=n.data||{},T={},R={State:!0,Input:null,Outcomes:!0,Exception:!0};for(const e in j){if(!j.hasOwnProperty(e))continue;if(R[e])continue;const s=j[e];if(!s)continue;let l=null;l="string"==typeof s?s:"object"==typeof s?JSON.stringify(s,null,1):void 0===s?null:s.toString(),T[e]=l}const S=d(x),E=j.Outcomes&&j.Outcomes||[],A=j.Exception?j.Exception:null,M=e=>l("div",null,l("div",{class:"elsa-mb-4"},l("strong",{class:"elsa-block elsa-font-bold"},e.Type),e.Message),e.InnerException?l("div",{class:"elsa-ml-4"},M(e.InnerException)):void 0);return l("li",null,l("div",{onClick:()=>this.onRecordClick(n),class:`${C} elsa-border-2 elsa-cursor-pointer elsa-p-4 elsa-rounded`},l("div",{class:"elsa-relative elsa-pb-10"},m?void 0:l("div",{class:"elsa-flex elsa-absolute top-8 elsa-left-4 -elsa-ml-px elsa-h-full elsa-w-0.5"},l("div",{class:"elsa-flex elsa-flex-1 elsa-items-center elsa-relative elsa-right-10"},l("span",{class:"elsa-flex-1 elsa-text-sm elsa-text-gray-500 elsa-w-max elsa-bg-white elsa-p-1 elsa-rounded"},S))),l("div",{class:"elsa-relative elsa-flex elsa-space-x-3"},l("div",null,l("span",{class:"elsa-h-8 elsa-w-8 elsa-rounded-full elsa-bg-green-500 elsa-flex elsa-items-center elsa-justify-center elsa-ring-8 elsa-ring-white",innerHTML:g})),l("div",{class:"elsa-min-w-0 elsa-flex-1 elsa-pt-1.5 elsa-flex elsa-justify-between elsa-space-x-4"},l("div",null,l("h3",{class:"elsa-text-lg elsa-leading-6 elsa-font-medium elsa-text-gray-900"},y)),l("div",null,l("span",{class:"elsa-relative elsa-inline-flex elsa-items-center elsa-rounded-full elsa-border elsa-border-gray-300 elsa-px-3 elsa-py-0.5 elsa-text-sm"},l("span",{class:"elsa-absolute elsa-flex-shrink-0 elsa-flex elsa-items-center elsa-justify-center"},l("span",{class:`elsa-h-1.5 elsa-w-1.5 elsa-rounded-full elsa-bg-${I}-500`,"aria-hidden":"true"})),l("span",{class:"elsa-ml-3.5 elsa-font-medium elsa-text-gray-900"},k))),l("div",{class:"elsa-text-right elsa-text-sm elsa-whitespace-nowrap elsa-text-gray-500"},l("span",null,f.format("DD-MM-YYYY HH:mm:ss"))))),l("div",{class:"elsa-ml-12 elsa-mt-2"},l("dl",{class:"sm:elsa-divide-y sm:elsa-divide-gray-200"},l("div",{class:"elsa-grid elsa-grid-cols-2 elsa-gap-x-4 elsa-gap-y-8 sm:elsa-grid-cols-2"},l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Activity ID"),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2"},n.activityId)),E.length>0?l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Outcomes"),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2"},l("div",{class:"elsa-flex elsa-flex-col elsa-space-y-4 sm:elsa-space-y-0 sm:elsa-flex-row sm:elsa-space-x-4"},E.map((e=>l("span",{class:"elsa-inline-flex elsa-items-center elsa-px-3 elsa-py-0.5 elsa-rounded-full elsa-text-sm elsa-font-medium elsa-bg-blue-100 elsa-text-blue-800"},e)))))):void 0,n.message&&!A?l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Message"),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900"},n.message)):void 0,A?[l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Exception"),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900"},M(A))),l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500"},"Exception Details"),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-overflow-x-auto"},l("pre",{onClick:e=>u(e.currentTarget)},JSON.stringify(A,null,1))))]:void 0,t.map(T,((e,s)=>l("div",{class:"sm:elsa-col-span-2"},l("dt",{class:"elsa-text-sm elsa-font-medium elsa-text-gray-500 elsa-capitalize"},s),l("dd",{class:"elsa-mt-1 elsa-text-sm elsa-text-gray-900 elsa-mb-2 elsa-overflow-x-auto"},l("pre",{onClick:e=>u(e.currentTarget)},e)))))))))))}))))},this.renderActivityStateTab=()=>{const e=this.workflowModel&&this.selectedActivityId?this.workflowModel.activities.find((e=>e.activityId===this.selectedActivityId)):null;if(!e)return l("p",null,"No activity selected");const s=Object.assign(Object.assign({},e),{properties:e.properties.map((e=>({name:e.name,value:e.value})))});return l("div",null,l("pre",null,JSON.stringify(s,null,2)))},this.tabs=[{id:"journal",text:"Journal",view:this.renderJournalTab},{id:"activityState",text:"Activity State",view:this.renderActivityStateTab}]}async show(){this.isVisible||(this.isVisible=!0,n(this.el))}async hide(){this.isVisible&&r(this.el).then((()=>this.isVisible=!1))}async selectActivityRecord(e){const s=e?this.filteredRecords.find((s=>s.activityId==e)):null;this.selectActivityRecordInternal(s),await this.show()}async workflowInstanceIdChangedHandler(e){const s=e,l=c(this.serverUrl);if(s&&s.length>0)try{this.records=await l.workflowExecutionLogApi.get(s),this.filteredRecords=this.records.items.filter((e=>"Executing"!=e.eventName&&"Resuming"!=e.eventName))}catch(e){console.warn("The specified workflow instance does not exist.")}}async componentWillLoad(){await this.workflowInstanceIdChangedHandler(this.workflowInstanceId)}filterRecords(){}selectActivityRecordInternal(e){const s=e?this.workflowBlueprint.activities.find((s=>s.id===e.activityId)):null;this.selectedRecordId=e?e.id:null,this.selectedActivityId=null!=s?s.parentId&&s.parentId!=this.workflowBlueprint.id?s.parentId:s.id:null}getEventColor(e){return{Executing:"blue",Executed:"green",Faulted:"rose",Warning:"yellow",Information:"blue"}[e]||"gray"}onCloseClick(){this.hide()}onShowClick(){this.show()}onRecordClick(e){this.selectActivityRecordInternal(e),this.recordSelected.emit(e)}onTabClick(e,s){e.preventDefault(),this.selectedTabId=s.id}render(){return l(a,null,this.renderJournalButton(),this.renderPanel())}renderJournalButton(){return l("button",{onClick:()=>this.onShowClick(),type:"button",class:"workflow-settings-button elsa-fixed elsa-top-20 elsa-right-12 elsa-inline-flex elsa-items-center elsa-p-2 elsa-rounded-full elsa-border elsa-border-transparent elsa-bg-white elsa-shadow elsa-text-gray-400 hover:elsa-text-blue-500 focus:elsa-text-blue-500 hover:elsa-ring-2 hover:elsa-ring-offset-2 hover:elsa-ring-blue-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",stroke:"currentColor",fill:"none",class:"elsa-h-8 elsa-w-8"},l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})))}renderPanel(){const e=this.isVisible?"":"hidden",s=this.tabs,a=this.selectedTabId,t=s.find((e=>e.id===a));return l("section",{class:`${e} elsa-fixed elsa-top-0 elsa-right-0 elsa-bottom-0 elsa-overflow-hidden`,"aria-labelledby":"slide-over-title",role:"dialog","aria-modal":"true"},l("div",{class:"elsa-absolute elsa-inset-0 elsa-overflow-hidden"},l("div",{class:"elsa-absolute elsa-inset-0","aria-hidden":"true"}),l("div",{class:"elsa-fixed elsa-inset-y-0 elsa-right-0 elsa-pl-10 max-elsa-w-full elsa-flex sm:elsa-pl-16"},l("div",{ref:e=>this.el=e,"data-transition-enter":"elsa-transform elsa-transition elsa-ease-in-out elsa-duration-500 sm:elsa-duration-700","data-transition-enter-start":"elsa-translate-x-full","data-transition-enter-end":"elsa-translate-x-0","data-transition-leave":"elsa-transform elsa-transition elsa-ease-in-out elsa-duration-500 sm:elsa-duration-700","data-transition-leave-start":"elsa-translate-x-0","data-transition-leave-end":"elsa-translate-x-full",class:"elsa-w-screen elsa-max-w-2xl"},l("div",{class:"elsa-h-full elsa-flex elsa-flex-col elsa-py-6 elsa-bg-white elsa-shadow-xl elsa-overflow-y-scroll"},l("div",{class:"elsa-px-4 sm:elsa-px-6"},l("div",{class:"elsa-flex elsa-flex-col elsa-items-end"},l("div",{class:"elsa-ml-3 h-7 elsa-flex elsa-items-center"},l("button",{type:"button",onClick:()=>this.onCloseClick(),class:"elsa-bg-white elsa-rounded-md elsa-text-gray-400 hover:elsa-text-gray-500 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500"},l("span",{class:"elsa-sr-only"},"Close panel"),l("svg",{class:"elsa-h-6 elsa-w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true"},l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"}))))),l("div",null,l("div",null,l("div",{class:"elsa-border-b elsa-border-gray-200"},l("nav",{class:"-elsa-mb-px elsa-flex elsa-space-x-8","aria-label":"Tabs"},s.map((e=>l("a",{href:"#",onClick:s=>this.onTabClick(s,e),class:(e.id==a?"elsa-border-blue-500 elsa-text-blue-600":"elsa-border-transparent elsa-text-gray-500 hover:elsa-text-gray-700 hover:elsa-border-gray-300")+" elsa-whitespace-nowrap elsa-py-4 elsa-px-1 elsa-border-b-2 elsa-font-medium elsa-text-sm"},e.text)))))))),l("div",{class:"elsa-mt-6 elsa-relative elsa-flex-1 elsa-px-4 sm:elsa-px-6"},l("div",{class:"elsa-absolute elsa-inset-0 elsa-px-4 sm:elsa-px-6"},t.view())))))))}static get watchers(){return{workflowInstanceId:["workflowInstanceIdChangedHandler"]}}};export{m as elsa_workflow_instance_journal};